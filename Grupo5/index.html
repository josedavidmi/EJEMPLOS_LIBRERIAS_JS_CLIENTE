<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cl√≠nica Veterinaria - Patitas</title>
    
    <!-- FullCalendar -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    
    <!-- flatpickr -->
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css'>
    <script src='https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/l10n/es.js'></script>
    
    <!-- Tabulator -->
    <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">
    <script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>
    
    <!-- FilePond -->
    <link href="https://unpkg.com/filepond@4.30.4/dist/filepond.css" rel="stylesheet">
    <script src="https://unpkg.com/filepond@4.30.4/dist/filepond.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #43C6AC 0%, #191654 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #191654;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 {
            color: #2c3e50;
            margin: 25px 0 15px;
            font-size: 1.5rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        /* Cards */
        .card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
        }

        /* Calendario */
        #calendario {
            background: white;
            padding: 15px;
            border-radius: 15px;
            height: auto;
            min-height: 500px;
        }

        /* Formulario cita */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #43C6AC;
            box-shadow: 0 0 0 3px rgba(67, 198, 172, 0.2);
        }

        button {
            background: linear-gradient(135deg, #43C6AC, #191654);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(67, 198, 172, 0.3);
        }

        /* Historial m√©dico */
        .historial-entry {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #43C6AC;
        }

        .historial-fecha {
            color: #43C6AC;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .historial-titulo {
            font-weight: bold;
            color: #191654;
            margin: 5px 0;
        }

        /* FilePond custom */
        .filepond--root {
            margin-bottom: 15px;
        }

        .filepond--panel-root {
            background-color: #f8f9fa;
            border: 2px dashed #43C6AC;
        }

        /* Mascota avatar */
        .mascota-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #43C6AC, #191654);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
        }

        .veterinarios-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }

        .vet-1 { background: #FF6B6B; }
        .vet-2 { background: #4ECDC4; }
        .vet-3 { background: #FFE66D; color: #333; }

        /* Stats */
        .stats-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .stat-icon {
            font-size: 2.5rem;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            color: #191654;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêæ Cl√≠nica Veterinaria Patitas</h1>

        <!-- Stats r√°pidas -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">üêï</div>
                <div class="stat-info">
                    <h3 id="stats-pacientes">24</h3>
                    <p>Pacientes activos</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-info">
                    <h3 id="stats-citas-hoy">8</h3>
                    <p>Citas para hoy</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üè•</div>
                <div class="stat-info">
                    <h3 id="stats-veterinarios">3</h3>
                    <p>Veterinarios</p>
                </div>
            </div>
        </div>

        <!-- Grid principal -->
        <div class="grid-2">
            <!-- FULLCALENDAR - Agenda de citas -->
            <div class="card">
                <h2>üìã Agenda de citas</h2>
                <div id="calendario"></div>
            </div>

            <!-- Formulario nueva cita + flatpickr -->
            <div class="card">
                <h2>‚ûï Nueva cita</h2>
                
                <div class="form-group">
                    <label>Mascota</label>
                    <select id="cita-mascota">
                        <option value="1">üêï Max - Golden Retriever</option>
                        <option value="2">üêà Luna - Gato Persa</option>
                        <option value="3">üêï Toby - Bulldog Franc√©s</option>
                        <option value="4">üêà Simba - Gato Com√∫n</option>
                        <option value="5">üêï Kira - Pastor Alem√°n</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Veterinario</label>
                    <select id="cita-veterinario">
                        <option value="Dra. Mart√≠nez">üë©‚Äç‚öïÔ∏è Dra. Mart√≠nez (Cirug√≠a)</option>
                        <option value="Dr. Garc√≠a">üë®‚Äç‚öïÔ∏è Dr. Garc√≠a (Dermatolog√≠a)</option>
                        <option value="Dra. L√≥pez">üë©‚Äç‚öïÔ∏è Dra. L√≥pez (Odontolog√≠a)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tipo de consulta</label>
                    <select id="cita-tipo">
                        <option value="Revisi√≥n">ü©∫ Revisi√≥n general</option>
                        <option value="Vacunaci√≥n">üíâ Vacunaci√≥n</option>
                        <option value="Urgencia">üöë Urgencia</option>
                        <option value="Cirug√≠a">üî™ Cirug√≠a</option>
                        <option value="Odontolog√≠a">ü¶∑ Limpieza dental</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Fecha y hora</label>
                    <input type="text" id="cita-fecha" placeholder="Selecciona fecha y hora">
                </div>

                <div class="form-group">
                    <label>Motivo de la consulta</label>
                    <textarea id="cita-motivo" rows="2" placeholder="Describe el motivo..."></textarea>
                </div>

                <!-- FilePond - Subir foto/informe (opcional) -->
                <div class="form-group">
                    <label>üìé Adjuntar documento (opcional)</label>
                    <input type="file" id="filepond-upload" name="filepond" multiple>
                </div>

                <button onclick="crearCita()">üìÖ Programar cita</button>
            </div>
        </div>

        <!-- Tabulator - Listado de pacientes -->
        <h2>üêï Pacientes registrados</h2>
        <div id="tabla-pacientes"></div>

        <!-- Historial m√©dico + adjuntos -->
        <h2>üìñ Historial m√©dico</h2>
        <div class="grid-2">
            <!-- Listado de historial -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">üìã Historial de Max</h3>
                    <span class="veterinarios-badge vet-1">Dra. Mart√≠nez</span>
                </div>
                <div id="historial-container">
                    <div class="historial-entry">
                        <div class="historial-fecha">üìÖ 10/02/2026 - 11:30</div>
                        <div class="historial-titulo">ü©∫ Revisi√≥n anual</div>
                        <p>Todo correcto, vacunaci√≥n al d√≠a. Se recomienda dieta para control de peso.</p>
                        <div style="margin-top: 10px;">
                            <span style="background: #e0e0e0; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem;">üìé analisis_sangre.pdf</span>
                            <span style="background: #e0e0e0; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem;">üñºÔ∏è radiografia.jpg</span>
                        </div>
                    </div>
                    <div class="historial-entry">
                        <div class="historial-fecha">üìÖ 15/01/2026 - 10:15</div>
                        <div class="historial-titulo">üíâ Vacunaci√≥n</div>
                        <p>Vacuna polivalente aplicada. Pr√≥xima dosis en 3 meses.</p>
                        <div style="margin-top: 10px;">
                            <span style="background: #e0e0e0; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem;">üìÑ certificado_vacuna.pdf</span>
                        </div>
                    </div>
                    <div class="historial-entry">
                        <div class="historial-fecha">üìÖ 20/12/2025 - 16:45</div>
                        <div class="historial-titulo">üöë Urgencia - Otitis</div>
                        <p>Infecci√≥n de o√≠do. Tratamiento con antibi√≥tico durante 7 d√≠as.</p>
                        <div style="margin-top: 10px;">
                            <span style="background: #e0e0e0; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem;">üìã receta.pdf</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Adjuntos recientes -->
            <div class="card">
                <h3>üìé √öltimos adjuntos</h3>
                <div style="margin-top: 15px;">
                    <div style="display: flex; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px;">
                        <span style="font-size: 1.5rem; margin-right: 15px;">üñºÔ∏è</span>
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">Radiograf√≠a - Max</div>
                            <div style="font-size: 0.8rem; color: #666;">15/02/2026 ‚Ä¢ 2.3 MB</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px;">
                        <span style="font-size: 1.5rem; margin-right: 15px;">üìÑ</span>
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">An√°lisis sangre - Luna</div>
                            <div style="font-size: 0.8rem; color: #666;">14/02/2026 ‚Ä¢ 1.1 MB</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 10px;">
                        <span style="font-size: 1.5rem; margin-right: 15px;">üìã</span>
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">Informe cirug√≠a - Toby</div>
                            <div style="font-size: 0.8rem; color: #666;">10/02/2026 ‚Ä¢ 0.8 MB</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ DATOS DE EJEMPLO ============
        const pacientes = [
            { id: 1, nombre: 'Max', especie: 'Perro', raza: 'Golden Retriever', edad: 5, dueno: 'Carlos Ruiz', telefono: '612345678' },
            { id: 2, nombre: 'Luna', especie: 'Gato', raza: 'Persa', edad: 3, dueno: 'Ana Garc√≠a', telefono: '623456789' },
            { id: 3, nombre: 'Toby', especie: 'Perro', raza: 'Bulldog Franc√©s', edad: 2, dueno: 'Mar√≠a L√≥pez', telefono: '634567890' },
            { id: 4, nombre: 'Simba', especie: 'Gato', raza: 'Com√∫n', edad: 7, dueno: 'Javier Mart√≠nez', telefono: '645678901' },
            { id: 5, nombre: 'Kira', especie: 'Perro', raza: 'Pastor Alem√°n', edad: 4, dueno: 'Laura S√°nchez', telefono: '656789012' }
        ];

        let citas = [
            { id: 1, title: 'Max - Revisi√≥n', start: '2026-02-13T10:00:00', veterinarian: 'Dra. Mart√≠nez', tipo: 'Revisi√≥n' },
            { id: 2, title: 'Luna - Vacunaci√≥n', start: '2026-02-13T11:30:00', veterinarian: 'Dr. Garc√≠a', tipo: 'Vacunaci√≥n' },
            { id: 3, title: 'Toby - Cirug√≠a', start: '2026-02-14T09:00:00', veterinarian: 'Dra. Mart√≠nez', tipo: 'Cirug√≠a' },
            { id: 4, title: 'Simba - Odontolog√≠a', start: '2026-02-14T12:00:00', veterinarian: 'Dra. L√≥pez', tipo: 'Odontolog√≠a' }
        ];

        // ============ 1. FULLCALENDAR ============
        const calendarEl = document.getElementById('calendario');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            locale: 'es',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: citas,
            slotMinTime: '08:00:00',
            slotMaxTime: '20:00:00',
            allDaySlot: false,
            height: 500,
            eventDidMount: function(info) {
                // Color por veterinario
                switch(info.event.extendedProps.veterinarian) {
                    case 'Dra. Mart√≠nez':
                        info.el.style.backgroundColor = '#FF6B6B';
                        break;
                    case 'Dr. Garc√≠a':
                        info.el.style.backgroundColor = '#4ECDC4';
                        break;
                    case 'Dra. L√≥pez':
                        info.el.style.backgroundColor = '#FFE66D';
                        info.el.style.color = '#333';
                        break;
                }
            },
            eventClick: function(info) {
                alert(`üìÖ Cita: ${info.event.title}\nüë©‚Äç‚öïÔ∏è Veterinario: ${info.event.extendedProps.veterinarian}\nü©∫ Tipo: ${info.event.extendedProps.tipo}`);
            }
        });

        calendar.render();

        // ============ 2. FLATPICKR ============
        const flatpickrInstance = flatpickr("#cita-fecha", {
            locale: 'es',
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            minDate: "today",
            defaultDate: new Date(),
            time_24hr: true,
            minTime: "08:00",
            maxTime: "20:00"
        });

        // ============ 3. FILEPOND - SUBIR ARCHIVOS ============
        const pond = FilePond.create(document.querySelector('#filepond-upload'), {
            labelIdle: 'üìé Arrastra tus archivos o <span style="color: #43C6AC;">haz clic</span>',
            acceptedFileTypes: ['image/*', 'application/pdf', '.doc', '.docx'],
            maxFileSize: '10MB',
            server: {
                process: {
                    url: '/upload.php',
                    onload: (response) => {
                        console.log('‚úÖ Archivo subido:', response);
                        return response;
                    }
                }
            }
        });

        // ============ 4. TABULATOR - LISTADO PACIENTES ============
        const tablaPacientes = new Tabulator('#tabla-pacientes', {
            data: pacientes,
            layout: 'fitColumns',
            pagination: 'local',
            paginationSize: 5,
            movableColumns: true,
            resizableRows: false,
            columns: [
                { 
                    title: '', 
                    field: 'id',
                    width: 50,
                    formatter: function() {
                        return 'üêæ';
                    }
                },
                { title: 'Nombre', field: 'nombre', sorter: 'string', widthGrow: 2 },
                { title: 'Especie', field: 'especie', sorter: 'string', widthGrow: 1 },
                { title: 'Raza', field: 'raza', sorter: 'string', widthGrow: 2 },
                { 
                    title: 'Edad', 
                    field: 'edad', 
                    sorter: 'number',
                    widthGrow: 1,
                    formatter: function(cell) {
                        return `${cell.getValue()} a√±os`;
                    }
                },
                { title: 'Due√±o', field: 'dueno', sorter: 'string', widthGrow: 2 },
                { 
                    title: 'Contacto', 
                    field: 'telefono', 
                    sorter: 'string',
                    widthGrow: 2,
                    formatter: function(cell) {
                        return `üìû ${cell.getValue()}`;
                    }
                }
            ],
            placeholder: 'No hay pacientes registrados',
            initialSort: [
                { column: 'nombre', dir: 'asc' }
            ]
        });

        // ============ FUNCI√ìN CREAR CITA ============
        function crearCita() {
            const mascota = document.getElementById('cita-mascota');
            const veterinario = document.getElementById('cita-veterinario');
            const tipo = document.getElementById('cita-tipo');
            const fecha = document.getElementById('cita-fecha');
            const motivo = document.getElementById('cita-motivo');
            
            if (!mascota.value || !veterinario.value || !fecha.value) {
                alert('‚ùå Por favor, completa todos los campos obligatorios');
                return;
            }

            // Obtener nombre de la mascota
            const mascotaText = mascota.options[mascota.selectedIndex].text;
            const mascotaNombre = mascotaText.split('-')[1].trim();

            // Crear nueva cita
            const nuevaCita = {
                id: citas.length + 1,
                title: `${mascotaNombre} - ${tipo.value}`,
                start: fecha.value,
                veterinarian: veterinario.value,
                tipo: tipo.value
            };

            // Agregar al calendario
            citas.push(nuevaCita);
            calendar.addEvent(nuevaCita);

            // Limpiar formulario
            mascota.value = '1';
            veterinario.value = 'Dra. Mart√≠nez';
            tipo.value = 'Revisi√≥n';
            document.getElementById('cita-motivo').value = '';
            flatpickrInstance.setDate(new Date());
            
            // Eliminar archivos de FilePond
            pond.removeFiles();

            alert('‚úÖ Cita programada correctamente');
        }

        // ============ INICIALIZACI√ìN ============
        document.addEventListener('DOMContentLoaded', () => {
            // Actualizar stats
            const citasHoy = citas.filter(c => c.start.startsWith('2026-02-13')).length;
            document.getElementById('stats-citas-hoy').innerHTML = citasHoy;
            document.getElementById('stats-pacientes').innerHTML = pacientes.length;
        });
    </script>
</body>
</html>